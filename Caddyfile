archive.johncarolin.com {
    # Enable logging
    log {
        output file /var/log/caddy/archive.johncarolin.com.log
        format json
    }

    # Reverse proxy to the Flask app
    reverse_proxy localhost:8000 {
        # Health check
        health_uri /api/posts
        health_interval 30s
        health_timeout 10s
        health_status 200
    }

    # Security headers
    header {
        # Security headers
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        
        # Remove server header
        -Server
        
        # Cache static assets
        Cache-Control "public, max-age=31536000" /styles.css
        Cache-Control "public, max-age=31536000" /script.js
        Cache-Control "public, max-age=31536000" /spa.js
        Cache-Control "public, max-age=31536000" /masonry.js
        Cache-Control "public, max-age=31536000" /music.js
        Cache-Control "public, max-age=31536000" /instagram.js
        Cache-Control "public, max-age=31536000" /images/*
        Cache-Control "public, max-age=31536000" /posts/*
        
        # No cache for HTML files
        Cache-Control "no-cache, no-store, must-revalidate" /index.html
        Cache-Control "no-cache, no-store, must-revalidate" /about.html
        Cache-Control "no-cache, no-store, must-revalidate" /privacy.html
        Cache-Control "no-cache, no-store, must-revalidate" /tos.html
        Cache-Control "no-cache, no-store, must-revalidate" /deletion.html
    }

    # Gzip compression
    encode gzip
}
